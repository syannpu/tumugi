<div class="max-w-4xl mx-auto bg-white rounded-lg shadow-md p-6 mt-24">
  <%= form_with(model: @marche, local: true) do |form| %>
    <div class="mb-4">
      <label class="block text-gray-700 text-sm font-bold mb-2">
       画像
      </label>
  
  <!-- 現在の画像を表示 -->
      <% if @marche.images.present? %>
        <div class="mb-4">
          <p class="text-sm text-gray-600 mb-2">現在の画像:</p>
          <div class="grid grid-cols-2 md:grid-cols-3 gap-4">
            <% @marche.images.each_with_index do |image, index| %>
              <div class="relative">
                <%= image_tag image.url, class: "w-full h-32 object-cover rounded-lg border" %>
                  <div class="mt-2">
                  <%= check_box_tag "remove_images[]", index, false, 
                    id: "remove_image_#{index}", 
                    class: "mr-2" %>
                  <%= label_tag "remove_image_#{index}", "削除", 
                    class: "text-sm text-red-600" %>
                  </div>
              </div>
            <% end %>
        </div>
    </div>
  <% end %>
  
  <!-- 新しい画像をアップロード -->
    <div>
      <p class="text-sm text-gray-600 mb-2">新しい画像を追加:</p>
      <%= form.file_field :images, multiple: true,
          accept: "image/*", 
          class: "w-full px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" %>
    </div>

      <label class="block text-gray-700 text-sm font-bold mb-2">
        タイトル
      </label>
      <%= form.text_field :title, class: "w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" %>
    </div>

    <div class="mb-4">
      <label class="block text-gray-700 text-sm font-bold mb-2">
        このマルシェの魅力
      </label>
      <%= form.text_area :description, class: "w-full px-32 py-24 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 resize-none" %>
    </div>

    <div class="mb-4">
      <label class="block text-gray-700 text-sm font-bold mb-2">
        本文
      </label>
      <%= form.text_area :body, class: "w-full px-32 py-24 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 resize-none" %>
    </div>

    <div class="mb-4">
      <label class="block text-gray-700 text-sm font-bold mb-2">
        開催日
      </label>
      <%= form.datetime_local_field :held_at, class: "w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" %>
    </div>

    <div class="mb-4">
      <label class="block text-gray-700 text-sm font-bold mb-2">
        場所
      </label>
      <%= form.text_field :location, class: "w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" %>
    </div>

    <div class="mb-4">
      <label class="block text-gray-700 text-sm font-bold mb-2">
        出店募集開始
      </label>
      <%= form.datetime_local_field :start_at, class: "w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" %>
    </div>

<!-- 終了日時フィールド -->
    <div class="mb-4">
      <label class="block text-gray-700 text-sm font-bold mb-2">
        出店募集終了
      </label>
      <%= form.datetime_local_field :end_at, class: "w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" %>
    </div>

    <div class="field mb-4">
      <%= form.label :atmosphere_ids, "キーワードを選択", class: "block text-sm font-medium text-gray-700 mb-2" %>
    
      <div class="atmosphere-checkboxes space-y-2">
        <% @atmospheres.each do |atmosphere| %>
          <div class="flex items-center">
            <%= form.check_box :atmosphere_ids, 
              { 
                multiple: true, 
                checked: @marche.atmosphere_ids.include?(atmosphere.id),
                class: "mr-2"
              }, 
              atmosphere.id, "" %>
            <%= form.label "atmosphere_ids_#{atmosphere.id}", atmosphere.name, 
              class: "text-sm text-gray-700" %>
          </div>
        <% end %>
      </div>
    </div>

    <div class="field mb-4">
      <%= form.label :target_ids, "ターゲットを選択", class: "block text-sm font-medium text-gray-700 mb-2" %>
    
      <div class="target-checkboxes space-y-2">
        <% @targets.each do |target| %>
          <div class="flex items-center">
            <%= form.check_box :target_ids, 
              { 
                multiple: true, 
                checked: @marche.target_ids.include?(target.id),
                class: "mr-2"
              }, 
              target.id, "" %>
            <%= form.label "target_ids_#{target.id}", target.name, 
              class: "text-sm text-gray-700" %>
          </div>
        <% end %>
      </div>
    </div>

    <div class="field mb-4">
      <%= form.label :target_ids, "価格帯を選択", class: "block text-sm font-medium text-gray-700 mb-2" %>
    
      <div class="target-checkboxes space-y-2">
        <% @prices.each do |price| %>
          <div class="flex items-center">
            <%= form.check_box :price_ids, 
              { 
                multiple: true, 
                checked: @marche.price_ids.include?(price.id),
                class: "mr-2"
              }, 
              price.id, "" %>
            <%= form.label "price_ids_#{price.id}", price.name, 
              class: "text-sm text-gray-700" %>
          </div>
        <% end %>
      </div>
    </div>
 
  <div class="mb-4">
    <%= form.submit "更新する", class: "inline-flex items-center justify-center px-6 py-3 font-medium text-white bg-gradient-to-r from-orange-500 to-orange-600 rounded-full hover:from-orange-600 hover:to-orange-700 shadow-sm hover:shadow-md lg:px-4 lg:py-2 lg:w-auto transition-all duration-200" %>
  </div>
  <% end %>
</div>